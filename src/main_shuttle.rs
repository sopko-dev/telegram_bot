// –í–µ—Ä—Å—ñ—è –¥–ª—è Shuttle.dev
use teloxide::prelude::*;
use shuttle_runtime::SecretStore;

#[shuttle_runtime::main]
async fn main(
    #[shuttle_secrets::Secrets] secrets: SecretStore,
) -> shuttle_runtime::ShuttleResult<()> {
    println!("–ë–æ—Ç –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è...");

    let bot_token = secrets
        .get("TELEGRAM_BOT_TOKEN")
        .ok_or("TELEGRAM_BOT_TOKEN –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ! –ë—É–¥—å –ª–∞—Å–∫–∞, –≤—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å —Å–µ–∫—Ä–µ—Ç.")?;

    let bot = Bot::new(&bot_token);

    println!("–ë–æ—Ç –≥–æ—Ç–æ–≤–∏–π –¥–æ —Ä–æ–±–æ—Ç–∏!");

    // –°—Ç–≤–æ—Ä—é—î–º–æ –¥–∏—Å–ø–µ—Ç—á–µ—Ä
    use dptree;
    Dispatcher::builder(
        bot,
        dptree::entry()
            .branch(Update::filter_message().endpoint(handle_message))
            .branch(Update::filter_channel_post().endpoint(handle_message))
    )
        .enable_ctrlc_handler()
        .build()
        .dispatch()
        .await;

    Ok(())
}

async fn handle_message(bot: Bot, msg: Message) -> ResponseResult<()> {
    if let Some(text) = msg.text() {
        println!("–ë–æ—Ç –æ—Ç—Ä–∏–º–∞–≤ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è: {}", text);
        
        if text.starts_with('/') {
            let command = text.split('@').next().unwrap_or(text)
                .split_whitespace().next().unwrap_or(text);
            
            match command {
                "/start" => {
                    bot.send_message(msg.chat.id, 
                        "–í—ñ—Ç–∞—é! üëã\n\n\
                        –Ø –±–æ—Ç –¥–ª—è –∫–∞–Ω–∞–ª—É –ø—Ä–æ –∞–∫—Ç—É–∞–ª—å–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –¥–ª—è —É–∫—Ä–∞—ó–Ω—Ü—ñ–≤ —É –ß–µ—Ö—ñ—ó.\n\n\
                        –î–æ—Å—Ç—É–ø–Ω—ñ –∫–æ–º–∞–Ω–¥–∏:\n\
                        /start - –ø–æ—á–∞—Ç–∏ —Ä–æ–±–æ—Ç—É –∑ –±–æ—Ç–æ–º\n\
                        /help - –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ–ø–æ–º–æ–≥—É\n\
                        /info - —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –∫–∞–Ω–∞–ª")
                        .await?;
                }
                "/help" => {
                    bot.send_message(msg.chat.id,
                        "–î–æ–ø–æ–º–æ–≥–∞ ü§ù\n\n\
                        –Ø –º–æ–∂—É –¥–æ–ø–æ–º–æ–≥—Ç–∏ –≤–∞–º –∑ –Ω–∞—Å—Ç—É–ø–Ω–∏–º:\n\
                        ‚Ä¢ –û—Ç—Ä–∏–º–∞—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –∫–∞–Ω–∞–ª\n\
                        ‚Ä¢ –í—ñ–¥–ø–æ–≤—ñ—Å—Ç–∏ –Ω–∞ –≤–∞—à—ñ –∑–∞–ø–∏—Ç–∞–Ω–Ω—è\n\n\
                        –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –∫–æ–º–∞–Ω–¥–∏:\n\
                        /start - –ø–æ—á–∞—Ç–∏\n\
                        /help - —Ü—è –¥–æ–ø–æ–º–æ–≥–∞\n\
                        /info - —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –∫–∞–Ω–∞–ª")
                        .await?;
                }
                "/info" => {
                    bot.send_message(msg.chat.id,
                        "–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –∫–∞–Ω–∞–ª üì¢\n\n\
                        –¶–µ–π –∫–∞–Ω–∞–ª —Å—Ç–≤–æ—Ä–µ–Ω–∏–π –¥–ª—è —É–∫—Ä–∞—ó–Ω—Ü—ñ–≤, —è–∫—ñ –ø—Ä–æ–∂–∏–≤–∞—é—Ç—å —É –ß–µ—Ö—ñ—ó.\n\
                        –¢—É—Ç –≤–∏ –∑–Ω–∞–π–¥–µ—Ç–µ –∞–∫—Ç—É–∞–ª—å–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ:\n\
                        ‚Ä¢ –ñ–∏—Ç—Ç—è –≤ –ß–µ—Ö—ñ—ó\n\
                        ‚Ä¢ –ü—Ä–∞–≤–æ–≤—ñ –ø–∏—Ç–∞–Ω–Ω—è\n\
                        ‚Ä¢ –ö–æ—Ä–∏—Å–Ω—ñ —Ä–µ—Å—É—Ä—Å–∏\n\
                        ‚Ä¢ –ù–æ–≤—ñ –ø–æ–¥—ñ—ó —Ç–∞ –ø–æ–¥—ñ—ó\n\n\
                        –î—è–∫—É—î–º–æ, —â–æ –≤–∏ –∑ –Ω–∞–º–∏! üá∫üá¶üá®üáø")
                        .await?;
                }
                _ => {
                    bot.send_message(msg.chat.id,
                        "–í–∏–±–∞—á—Ç–µ, —è –Ω–µ —Ä–æ–∑—É–º—ñ—é —Ü—é –∫–æ–º–∞–Ω–¥—É. üòî\n\n\
                        –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ /help –¥–ª—è —Å–ø–∏—Å–∫—É –¥–æ—Å—Ç—É–ø–Ω–∏—Ö –∫–æ–º–∞–Ω–¥.")
                        .await?;
                }
            }
        } else {
            let text_lower = text.to_lowercase();
            let response = handle_question(&text_lower);
            bot.send_message(msg.chat.id, response).await?;
        }
    }

    Ok(())
}

fn handle_question(text: &str) -> &'static str {
    if text.contains("–ø—Ä–∏–≤—ñ—Ç") || text.contains("–≤—ñ—Ç–∞—é") || text.contains("hello") {
        return "–ü—Ä–∏–≤—ñ—Ç! üëã\n\n–ß–∏–º –º–æ–∂—É –¥–æ–ø–æ–º–æ–≥—Ç–∏? –í–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ /help –¥–ª—è —Å–ø–∏—Å–∫—É –∫–æ–º–∞–Ω–¥.";
    }
    
    if text.contains("–¥–æ–∫—É–º–µ–Ω—Ç") || text.contains("–≤—ñ–∑–∞") {
        return "üìÑ –î–æ–∫—É–º–µ–Ω—Ç–∏ —Ç–∞ –≤—ñ–∑–∏:\n\n–î–ª—è —É–∫—Ä–∞—ó–Ω—Ü—ñ–≤ —É –ß–µ—Ö—ñ—ó –¥–æ—Å—Ç—É–ø–Ω—ñ —Ä—ñ–∑–Ω—ñ —Ç–∏–ø–∏ –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤:\n‚Ä¢ –¢–∏–º—á–∞—Å–æ–≤–∏–π –∑–∞—Ö–∏—Å—Ç\n‚Ä¢ –í—ñ–∑–∞ –¥–ª—è –ø—Ä–∞—Ü–µ–≤–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è\n‚Ä¢ –í—ñ–∑–∞ –¥–ª—è –Ω–∞–≤—á–∞–Ω–Ω—è\n\n–†–µ–∫–æ–º–µ–Ω–¥—É—é –∑–≤–µ—Ä–Ω—É—Ç–∏—Å—è –¥–æ –º—ñ–≥—Ä–∞—Ü—ñ–π–Ω–æ—ó —Å–ª—É–∂–±–∏ –∞–±–æ –∫–æ–Ω—Å—É–ª—å—Å—Ç–≤–∞ –£–∫—Ä–∞—ó–Ω–∏ –≤ –ß–µ—Ö—ñ—ó.";
    }
    
    if text.contains("—Ä–æ–±–æ—Ç") || text.contains("–≤–∞–∫–∞–Ω—Å—ñ") {
        return "üíº –†–æ–±–æ—Ç–∞ –≤ –ß–µ—Ö—ñ—ó:\n\n–£–∫—Ä–∞—ó–Ω—Ü—ñ –º–∞—é—Ç—å –ø—Ä–∞–≤–æ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –≤ –ß–µ—Ö—ñ—ó –ø—ñ—Å–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤.\n\n–ö–æ—Ä–∏—Å–Ω—ñ —Ä–µ—Å—É—Ä—Å–∏:\n‚Ä¢ Jobs.cz\n‚Ä¢ Prace.cz\n‚Ä¢ Profesia.cz\n\n–ë–∞–∂–∞—é —É—Å–ø—ñ—Ö—ñ–≤ —É –ø–æ—à—É–∫—É —Ä–æ–±–æ—Ç–∏! üçÄ";
    }
    
    "–ü—Ä–∏–≤—ñ—Ç! üëã\n\n–Ø —Ä–æ–∑—É–º—ñ—é –≤–∞—à–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è. –ú–æ–∂—É –∫—Ä–∞—â–µ –¥–æ–ø–æ–º–æ–≥—Ç–∏, —è–∫—â–æ –≤–∏ –∑–∞–¥–∞—Å—Ç–µ –ø–∏—Ç–∞–Ω–Ω—è –±—ñ–ª—å—à –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ.\n\n–í–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ /help –¥–ª—è —Å–ø–∏—Å–∫—É –∫–æ–º–∞–Ω–¥."
}
